<nav class="fixed-top glass-navbar" dir="rtl">
  <div class="px-3 px-md-5 w-100">
    <div class="d-flex align-items-center justify-content-between w-100" style="min-height: 70px;">

      <!-- RIGHT GROUP (Start in RTL) -->
      <div class="d-flex align-items-center gap-3">

        <!-- MOBILE: Toggler -->
        <button class="btn btn-link text-dark border-0 p-0 d-lg-none" type="button" (click)="toggleMenu()">
          <i class="bi bi-list fs-1"></i>
        </button>

        <!-- MOBILE: User Avatar -->
        @if (authService.isLoggedIn()) {
        <div class="d-lg-none avatar-circle-sm" routerLink="/profile">
          @if (authService.currentUser()?.profileImageUrl) {
          <img [src]="authService.currentUser()?.profileImageUrl" class="w-100 h-100 rounded-circle object-fit-cover">
          } @else {
          {{ authService.currentUser()?.name?.charAt(0) }}
          }
        </div>
        }

        <!-- DESKTOP: Menu & Actions -->
        <div class="d-none d-lg-flex align-items-center gap-4">

          <!-- User Actions / Login -->
          @if (authService.isLoggedIn()) {
          <div class="position-relative">
            <div class="d-flex align-items-center user-dropdown-container" (click)="toggleUserMenu()">
              <div class="avatar-circle-sm ms-2">
                @if (authService.currentUser()?.profileImageUrl) {
                <img [src]="authService.currentUser()?.profileImageUrl"
                  class="w-100 h-100 rounded-circle object-fit-cover">
                } @else {
                {{ authService.currentUser()?.name?.charAt(0) }}
                }
              </div>
              <span class="fw-medium text-dark cursor-pointer">
                {{ authService.currentUser()?.name }} <i class="bi bi-chevron-down small opacity-50"></i>
              </span>
            </div>

            <!-- Desktop Dropdown -->
            @if (isUserMenuOpen()) {
            <div class="user-dropdown-menu shadow-lg rounded animate-fade-in">
              <a routerLink="/profile" class="dropdown-item d-flex align-items-center" (click)="closeUserMenu()">
                <i class="bi bi-person ms-2"></i> 驻专驻 砖
              </a>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item d-flex align-items-center text-danger" (click)="logoutWithConfirmation()">
                <i class="bi bi-box-arrow-right ms-2"></i> 转转拽转
              </button>
            </div>
            <div class="dropdown-backdrop" (click)="closeUserMenu()"></div>
            }
          </div>
          } @else {
          <a routerLink="/auth/login" class="nav-link fw-bold text-dark">住</a>
          }

          <!-- Navigation Links -->
          <div class="d-flex gap-4">
            <a routerLink="/missions/dashboard" routerLinkActive="active-link" class="nav-link"> 砖</a>
            @if (authService.hasRole('Client')) {
            <a routerLink="/missions/my-created" routerLinkActive="active-link" class="nav-link">砖 砖 </a>
            }
            @if (authService.hasRole('Courier')) {
            <a routerLink="/missions/my-missions" routerLinkActive="active-link" class="nav-link">砖 砖 </a>
            }
          </div>

        </div>
      </div>

      <!-- LEFT GROUP (End in RTL) - Logo -->
      <a routerLink="/" class="navbar-brand d-flex align-items-center gap-2" dir="ltr">
        <div class="d-flex">
          <span class="brand-text-tavi">Tavi</span>
          <span class="brand-text-li">Li</span>
        </div>
        <i class="bi bi-box-seam-fill brand-icon"></i>
      </a>

    </div>
  </div>

  <!-- MOBILE DRAWER (Offcanvasish) -->
  @if (isMenuOpen()) { <div class="menu-backdrop" (click)="closeMenu()"></div> }

  <div class="mobile-drawer d-lg-none" [class.show]="isMenuOpen()">
    <div class="p-4 d-flex flex-column h-100">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <span class="fw-bold fs-4">转驻专</span>
        <button class="btn-close" (click)="closeMenu()"></button>
      </div>

      <div class="d-flex flex-column gap-3">
        <a routerLink="/missions/dashboard" (click)="closeMenu()" class="nav-link fs-5"><i class="bi bi-grid ms-2"></i>
           砖</a>
        @if (authService.hasRole('Client')) {
        <a routerLink="/missions/my-created" (click)="closeMenu()" class="nav-link fs-5"><i
            class="bi bi-box-seam ms-2"></i> 砖 砖</a>
        }
        @if (authService.hasRole('Courier')) {
        <a routerLink="/missions/my-missions" (click)="closeMenu()" class="nav-link fs-5"><i
            class="bi bi-scooter ms-2"></i> 砖 砖</a>
        }
      </div>

      <div class="mt-auto border-top pt-3">
        @if (authService.isLoggedIn()) {
        <div class="d-flex align-items-center mb-3" (click)="closeMenu(); router.navigate(['/profile'])">
          <div class="avatar-circle-sm ms-2">
            @if (authService.currentUser()?.profileImageUrl) {
            <img [src]="authService.currentUser()?.profileImageUrl" class="w-100 h-100 rounded-circle object-fit-cover">
            } @else {
            {{ authService.currentUser()?.name?.charAt(0) }}
            }
          </div>
          <span class="fw-bold">{{ authService.currentUser()?.name }}</span>
        </div>
        <button class="btn btn-outline-danger w-100 py-2 rounded-3" (click)="logoutWithConfirmation()">转转拽转</button>
        } @else {
        <a routerLink="/auth/login" (click)="closeMenu()" class="btn btn-primary w-100 py-2 rounded-3">住 注专转</a>
        }
      </div>
    </div>
  </div>
</nav>